export const metadata = {
  emoji: 'âŒ¨ï¸',
  title: 'Auto Hide Keyboard',
  source: 'https://github.com/idootop/auto_hide_keyboard',
  preview: 'https://pub.dev/packages/auto_hide_keyboard',
  createAt: '2021-08',
  description:
    'Automatically hides the keyboard when tapping outside the TextField',
  cover: '',
};

# é¡¹ç›®é¢„è§ˆ

import demo from './demo.gif';

<WrappedImage src={demo.src} alt="ç‚¹å‡»ç©ºç™½å¤„è‡ªåŠ¨æ”¶èµ·è½¯é”®ç›˜" maxWidth="320px" />

# æŠ€æœ¯æµ…æ

æˆ‘ä»¬åœ¨ Flutter ä¸­å®ç°ç‚¹å‡»ç©ºç™½å¤„éšè—é”®ç›˜çš„éœ€æ±‚æ—¶ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š

### æ–¹æ¡ˆä¸€

åœ¨æ•´ä¸ªé¡µé¢å¤–éƒ¨åŒ…è£¹ä¸€ä¸ªGestureDetector

```dart
void hideKeyboard() => FocusManager.instance.primaryFocus?.unfocus();

class SomePage extends StatelessWidget {
    @override
    Widget build(BuildContext context) {
        return GestureDetector(
            onTap: hideKeyboard,
            child: Scaffold(
                body: ..., //something
            ),
        );
    }
}
```

æˆ–è€…å…¨å±€ä¸ºæ‰€æœ‰å­é¡µé¢éƒ½åŒ…è£¹ä¸€ä¸ª `GestureDetector`

```dart
class MyApp extends StatelessWidget {
    @override
    Widget build(BuildContext context) {
        return MaterialApp(
            title: 'Flutter Demo',
            builder: (context, child) => GestureDetector(
                onTap: hideKeyboard,
                child: child,
            ),
            home: ..., //home page
        );
    }
}
```

**ğŸ˜« ä½†æ˜¯è¿™ç§æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºé™·ï¼š**

å¦‚æœé¡µé¢ä¸­æœ‰å…¶ä»–æ¶ˆè´¹ç‚¹å‡»äº‹ä»¶çš„å­ç»„ä»¶ï¼Œæ¯”å¦‚ `Button`ï¼Œé‚£ä¹ˆåŒ…è£¹åœ¨å½“å‰é¡µé¢æœ€å¤–é¢çš„ `GestureDetector` å°†æ— æ³•å“åº”è¯¥ç‚¹å‡»äº‹ä»¶ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¯”è¾ƒç®€å•ç²—æš´çš„ä¸€ç§åšæ³•æ˜¯ï¼šä¸ºæ‰€æœ‰ç‚¹å‡»äº‹ä»¶å†è°ƒç”¨ä¸€æ¬¡`hideKeyboard()`ï¼ˆæƒ³æƒ³å°±å¾ˆåˆºæ¿€...ï¼‰

```dart
class SomePage extends StatelessWidget {

    void onTapButton(){
        hideKeyboard();
        ... //do something
    }

    @override
    Widget build(BuildContext context) {
        return GestureDetector(
            onTap: hideKeyboard,
            child: Scaffold(
                body: Column(
                    children: [
                        // ç‚¹å‡»æ­¤æŒ‰é’®çš„æ—¶å€™ï¼Œå¤–éƒ¨ GestureDetector çš„ onTap ä¸ä¼šå“åº”
                        TextButton(
                            onPressed: onTapButton, // éœ€è¦å†æ‰‹åŠ¨è°ƒç”¨ä¸€æ¬¡ hideKeyboard()
                            child: Text('æˆ‘æ˜¯æŒ‰é’®'),
                        ),
                        ... //something
                    ],
                ),
            ),
        );
    }
}
```

### æ–¹æ¡ˆäºŒ

é’ˆå¯¹æ–¹æ¡ˆä¸€ä¸­çš„ç¼ºé™·ï¼Œæˆ‘ä»¬å°è¯•å°†åŒ…è£¹åœ¨é¡µé¢å¤–éƒ¨çš„ `GestureDetector` æ¢æˆ `Listener`

```dart
class SomePage extends StatelessWidget {

    void onTapButton(){
        ... //do something
    }

    @override
    Widget build(BuildContext context) {
        return Listener(
            onPointerDown: (_) => hideKeyboard(),
            child: Scaffold(
                body: Column(
                    children: [
                        //ç‚¹å‡»æ­¤æŒ‰é’®çš„æ—¶å€™ï¼Œå¤–éƒ¨ Listener çš„ onPointerDown ä¹Ÿä¼šå“åº”
                        TextButton(
                            onPressed: onTapButton,
                            child: Text('æˆ‘æ˜¯æŒ‰é’®'),
                        ),
                        ... //something
                    ],
                ),
            ),
        );
    }
}
```

OKï¼Œç°åœ¨æ–¹æ¡ˆä¸€ä¸­çš„é—®é¢˜ä¼¼ä¹å·²ç»å®Œç¾è§£å†³äº†ã€‚

**ä½†æ˜¯**

ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œå¦‚æœåœ¨è¾“å…¥æ¡†èšç„¦é”®ç›˜å¼¹èµ·çš„çŠ¶æ€ä¸‹ï¼Œå†ç‚¹å‡»è¾“å…¥æ¡†åŒºåŸŸï¼Œ

æ­¤æ—¶å·²ç»å¼¹èµ·çš„é”®ç›˜ä¼šå…ˆæ”¶ä¸‹å»ï¼Œç„¶åé‡æ–°å¼¹å‡ºæ¥ã€‚

å¾ˆè›‹ç–¼ï½

## ğŸ’¡ è§£å†³æ€è·¯

ç®€å•åˆ†æå¯çŸ¥ï¼Œè§£å†³æ­¤éœ€æ±‚çš„å…³é”®æœ‰ä¸¤ç‚¹ï¼š

1. å“åº”å…¨å±€ç‚¹å‡»äº‹ä»¶ï¼Œä¸”ä¸å½±å“å·²æœ‰ç»„ä»¶ç‚¹å‡»äº‹ä»¶çš„åˆ†å‘å“åº”
2. è·å–ç‚¹å‡»åæ ‡ï¼Œåˆ¤æ–­æ˜¯å¦å‘½ä¸­è¾“å…¥æ¡†ç»„ä»¶æ‰€åœ¨åŒºåŸŸ

**1. å¦‚ä½•ç›‘å¬å…¨å±€ç‚¹å‡»äº‹ä»¶ï¼Œä¸”ä¸å½±å“å·²æœ‰ç»„ä»¶ç‚¹å‡»äº‹ä»¶çš„åˆ†å‘å“åº”**

å¯¹äºç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä» `ToolTip` ç»„ä»¶çš„æºç ä¸­è·å¾—äº†çµæ„Ÿ

```dart
class _TooltipState extends State<Tooltip> withSingleTickerProviderStateMixin {
    ...
    void _handlePointerEvent(PointerEvent event) {
        ...
        if (event is PointerUpEvent || event is PointerCancelEvent) {
            _hideTooltip();
        } else if (event is PointerDownEvent) {
            _hideTooltip(immediately: true);
        }
    }

    @override
    void initState() {
        super.initState();
        ...
        // Listen to global pointer events so that we can hide a tooltip immediately
        // if some other control is clicked on.
        GestureBinding.instance!.pointerRouter.addGlobalRoute(_handlePointerEvent);
    }

    @override
    void dispose() {
        GestureBinding.instance!.pointerRouter.removeGlobalRoute(_handlePointerEvent);
        ...
        super.dispose();
    }
    ...
}
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `GestureBinding.instance!.pointerRouter` æ³¨å†Œå…¨å±€ç‚¹å‡»äº‹ä»¶å›è°ƒï¼Œå¹¶ä¸”å¯ä»¥ä» `PointerEvent` æ‹¿åˆ°ç‚¹å‡»åæ ‡ã€‚

è‡³æ­¤æˆ‘ä»¬è§£å†³äº†é—®é¢˜çš„ä¸€å¤§åŠã€‚

æ¥ç€å¾€ä¸‹çœ‹ï¼Œå¦‚ä½•æ‹¿åˆ°è¾“å…¥æ¡†ç»„ä»¶æ‰€åœ¨çš„åŒºåŸŸï¼Ÿ

**2. å¦‚ä½•è·å–è¾“å…¥æ¡†ç»„ä»¶æ‰€åœ¨çš„åŒºåŸŸï¼Œåˆ¤æ–­ç‚¹å‡»åæ ‡æ˜¯å¦å‘½ä¸­**

è¿™ä¸ªé—®é¢˜æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å…¥æ¡†ç»„ä»¶çš„ `BuildContext` æ‹¿åˆ°å®ƒçš„ `RenderObject`ï¼Œç„¶åé€šè¿‡ `RenderBox.localToGlobal` å³å¯å¾—åˆ°è¾“å…¥æ¡†ç»„ä»¶æ‰€åœ¨çš„åŒºåŸŸã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```dart
  void _handlePointerEvent(PointerEvent event) {
    final randerObject = context.findRenderObject();
    if (randerObject is RenderBox) {
      final box = randerObject;
      final target = box.localToGlobal(Offset.zero) & box.size;
      final inSide = target.contains(event.position);
      ...
    }
  }
```

OKï¼ŒåŸºäºä¸Šè¿°ä¸¤ç‚¹æˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ªæ›´é è°±çš„ç‚¹å‡»ç©ºç™½å¤„éšè—é”®ç›˜çš„è§£å†³æ–¹æ¡ˆã€‚
